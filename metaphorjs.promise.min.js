(function(){var r="undefined"!=typeof window?window.setTimeout:global.setTimeout,k=function(a){var b;return!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof(b=a.then)?!1:b},d=function(a,b){return function(){return a.apply(b,arguments)}},m=[],n=!1,s="undefined"!=typeof process?process.nextTick:function(a){r(a,0)},p=function(){n=!0;var a=m.shift();s(function(){a[0].apply(a[1],a[2]);m.length?p():n=!1},0)},g=function(a,b,c){c=c||[];m.push([a,b,c]);n||p()},l=function(a,b){return function(c){try{b.resolve(a(c))}catch(e){b.reject(e)}}},
e=function(a,b){this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(a)if(k(a))this.resolve(a);else if("function"==typeof a)try{a.call(b,d(this.resolve,this),d(this.reject,this))}catch(c){this.reject(c)}else throw Error("Cannot construct Promise with given value");};(function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(e.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},
isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,b){var c;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(c=k(a)){a instanceof e?a.then(d(this._processResolveValue,this),d(this._processRejectReason,this)):(new e(c,a)).then(d(this._processResolveValue,this),d(this._processRejectReason,
this));return}}catch(f){0==this._state&&this._doReject(f);return}b.call(this,a)}},_doResolve:function(a){this._value=a;this._state=1;a=this._fulfills;for(var b;b=a.shift();)g(b[0],b[1],[this._value]);this._done();this._cleanup()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){this._triggered||(this._triggered=!0,this._processResolveValue(a))},_doReject:function(a){this._state=2;this._reason=a;for(var b=this._rejects,c;c=b.shift();)g(c[0],c[1],[a]);this._fail();
this._cleanup()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){this._triggered||(this._triggered=!0,this._processRejectReason(a))},then:function(a,b){var c=new e,f=this._state;0==f?(a&&"function"==typeof a?this._fulfills.push([l(a,c),null]):this._fulfills.push([c.resolve,c]),b&&"function"==typeof b?this._rejects.push([l(b,c),null]):this._rejects.push([c.reject,c])):1==f?a&&"function"==typeof a?g(l(a,c),null,[this._value]):c.resolve(this._value):2==f&&(b&&
"function"==typeof b?g(l(b,c),null,[this._reason]):c.reject(this._reason));return c},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)b[0].call(b[1]||null,this._value)},done:function(a,b){0==this._state?this._dones.push([a,b]):a.call(b||null,this._value);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)b[0].call(b[1]||null,this._value)},fail:function(a,b){0==this._state?this._fails.push([a,b]):a.call(b||null,this._reason);return this}},
{resolve:function(a){if(k(a)||"function"==typeof a)return new e(a);var b=new e;b.resolve(a);return b},reject:function(a){var b=new e;b.reject(a);return b},all:function(a){var b=new e,c=a.length,f=[],q=c,d,h,g=function(a){f.push(a);q--;0==q&&b.resolve(f)};for(d=0;d<c;d++)h=a[d],h instanceof e?h.done(g).fail(b.reject,b):k(h)||"function"==typeof h?(new e(h)).done(g).fail(b.reject,b):g(h);return b},race:function(a){var b=new e,c=a.length,f,d;for(f=0;f<c&&(d=a[f],d instanceof e?d.done(b.resolve,b).fail(b.reject,
b):k(d)||"function"==typeof d?(new e(d)).done(b.resolve,b).fail(b.reject,b):b.resolve(d),b.isPending());f++);return b}});"undefined"==typeof global?(window.Promise||(window.Promise=e),window.MetaphorJs&&window.MetaphorJs.d("MetaphorJs.lib.Promise",e)):"undefined"!=typeof module&&(module.exports=e)})();

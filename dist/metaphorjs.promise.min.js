(function(){var l={lib:{},cmp:{},view:{}},k=function(d){return"function"===typeof d},n=function(d){var f;return d&&(null!=d&&"object"===typeof d||k(d))?k(f=d.then)?f:!1:!1},g=Function.prototype.bind?function(d,f){return d.bind(f)}:function(d,f){return function(){return d.apply(f,arguments)}},t=function(d,f,k){setTimeout(function(){d.apply(f,k||[])},0)},r=function(d){var f=d.stack||Error().stack;t(function(){"undefined"!=typeof console&&console.log&&(console.log(d),f&&console.log(f))})},u=function(){var d=
[],f=!1,l="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},s=function(){f=!0;var a=d.shift();l(function(){a[0].apply(a[1],a[2]);d.length?s():f=!1},0)},p=function(a,b,c){c=c||[];d.push([a,b,c]);f||s()},q=function(a,b){return function(c){try{b.resolve(a(c))}catch(e){b.reject(e)}}},e=function(a,b){if(a instanceof e)return a;if(!(this instanceof e))return new e(a,b);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if("undefined"!=typeof a)if(n(a)||!k(a))this.resolve(a);
else try{a.call(b,g(this.resolve,this),g(this.reject,this))}catch(c){this.reject(c)}};e.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,b){var c;if(0==this._state)if(a===
this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(c=n(a)){a instanceof e?a.then(g(this._processResolveValue,this),g(this._processRejectReason,this)):(new e(c,a)).then(g(this._processResolveValue,this),g(this._processRejectReason,this));return}}catch(d){0==this._state&&this._doReject(d);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,b;b=a.shift();)p(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=
a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=this._rejects,b;b=a.shift();)p(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,
this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,b){var c=new e,d=this._state;0==d||0!=this._wait?(a&&k(a)?this._fulfills.push([q(a,c),null]):this._fulfills.push([c.resolve,c]),b&&k(b)?this._rejects.push([q(b,c),null]):this._rejects.push([c.reject,c])):1==d?a&&k(a)?p(q(a,c),null,[this._value]):c.resolve(this._value):2==d&&(b&&k(b)?p(q(b,c),null,[this._reason]):c.reject(this._reason));return c},"catch":function(a){return this.then(null,
a)},_done:function(){for(var a=this._dones,b;b=a.shift();)try{b[0].call(b[1]||null,this._value)}catch(c){r(c)}},done:function(a,b){var c=this._state;1==c&&0==this._wait?a.call(b||null,this._value):0==c&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)try{b[0].call(b[1]||null,this._reason)}catch(c){r(c)}},fail:function(a,b){var c=this._state;2==c&&0==this._wait?a.call(b||null,this._reason):0==c&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,
b);this.fail(a,b);return this},promise:function(){return{then:g(this.then,this),done:g(this.done,this),fail:g(this.fail,this),always:g(this.always,this)}},after:function(a){var b=this;if(n(a)){b._wait++;var c=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};k(a.done)?a.done(c):a.then(c)}return b}};e.resolve=function(a){return new e(a)};e.reject=function(a){var b=new e;b.reject(a);return b};e.all=function(a){if(!a.length)return e.resolve(null);
var b=new e,c=a.length,d=Array(c),f=c,g,h,m=function(a,c){d[c]=a;f--;0==f&&b.resolve(d)};for(g=0;g<c;g++)(function(c){h=a[g];h instanceof e?h.done(function(a){m(a,c)}).fail(b.reject,b):n(h)||k(h)?(new e(h)).done(function(a){m(a,c)}).fail(b.reject,b):m(h,c)})(g);return b};e.when=function(){return e.all(arguments)};e.allResolved=function(a){if(!a.length)return e.resolve(null);var b=new e,c=a.length,d=[],f=c,g,h,m=function(a){d.push(a);l()},l=function(){f--;0==f&&b.resolve(d)};for(g=0;g<c;g++)h=a[g],
h instanceof e?h.done(m).fail(l):n(h)||k(h)?(new e(h)).done(m).fail(l):m(h);return b};e.race=function(a){if(!a.length)return e.resolve(null);var b=new e,c=a.length,d,f;for(d=0;d<c&&(f=a[d],f instanceof e?f.done(b.resolve,b).fail(b.reject,b):n(f)||k(f)?(new e(f)).done(b.resolve,b).fail(b.reject,b):b.resolve(f),b.isPending());d++);return b};return e}();l.lib.Promise=u;"undefined"!=typeof global?global.MetaphorJs=l:window.MetaphorJs=l})();
